<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ohavei Tsion - Live Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap');
        
        :root {
            --gold: #d4af37;
            --light-gold: #f6e08a;
            --deep-blue: #0a2472;
            --bright-blue: #1e40af;
        }

        body { 
            font-family: 'Assistant', sans-serif; 
            background: radial-gradient(circle, #1e40af 0%, #0a1e5a 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        /* Cadre doré extérieur comme sur l'écran */
        .screen-border {
            border: 4px solid var(--gold);
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(251, 191, 36, 0.3);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.05);
            margin: 10px;
            padding: 20px;
        }

        /* Style des "Boîtes" de temps (White glass) */
        .time-box {
            background: white;
            border-radius: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            color: var(--deep-blue);
            padding: 10px;
            text-align: center;
        }

        .label-gold {
            color: var(--light-gold);
            text-transform: uppercase;
            font-size: 0.75rem;
            font-weight: 800;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .header-top {
            background: linear-gradient(to bottom, #1e3a8a, #0a2472);
            border-bottom: 2px solid var(--gold);
            padding: 10px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }

        .fixed-layout { direction: ltr !important; }
        .content-rtl { direction: rtl; }
    </style>
</head>
<body class="p-2">

    <div class="screen-border min-height-screen">
        
        <div class="header-top mb-6">
            <div class="flex items-center gap-4">
                <img src="https://ohavei-tsion.org/wp-content/uploads/2019/04/cropped-ohavei-logo-1.png" alt="Logo" class="h-12 w-auto brightness-110">
                <div class="h-10 w-px bg-gold/50 mx-2"></div>
                <h1 class="text-2xl font-black italic text-white tracking-widest">OHAVEI TSION</h1>
            </div>
            <div class="flex gap-2 fixed-layout">
                <button onclick="setLanguage('fr')" class="px-3 py-1 bg-white/10 border border-gold/50 rounded text-xs font-bold hover:bg-gold hover:text-blue-900 transition">FR</button>
                <button onclick="setLanguage('he')" class="px-3 py-1 bg-white/10 border border-gold/50 rounded text-xs font-bold hover:bg-gold hover:text-blue-900 transition">עב</button>
                <button onclick="setLanguage('en')" class="px-3 py-1 bg-white/10 border border-gold/50 rounded text-xs font-bold hover:bg-gold hover:text-blue-900 transition">EN</button>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="text-center">
                <p class="label-gold" data-i18n="parasha_label">Paracha</p>
                <div class="time-box"><span id="auto-paracha" class="text-2xl font-black">--</span></div>
            </div>
            <div class="text-center">
                <p class="label-gold" data-i18n="candles_label">Bougies</p>
                <div class="time-box"><span id="auto-candles" class="text-3xl font-black text-red-600">--:--</span></div>
            </div>
            <div class="text-center">
                <p class="label-gold" data-i18n="havdala_label">Havdala</p>
                <div class="time-box"><span id="auto-havdala" class="text-3xl font-black text-blue-900">--:--</span></div>
            </div>
        </div>

        <div id="main-grid" class="grid md:grid-cols-2 gap-6">
            
            <div class="bg-blue-900/40 border border-gold/30 rounded-xl overflow-hidden shadow-2xl">
                <div class="bg-gold text-blue-900 text-center font-black py-2 text-sm uppercase" data-i18n="title_week">Semaine</div>
                <div class="p-4 space-y-4">
                    <div class="flex justify-between items-center border-b border-white/10 pb-2">
                        <span id="label-chaharit_semaine" class="text-white/80 font-bold uppercase text-sm">Chaharit</span>
                        <span id="sheet-chaharit_semaine" class="text-3xl font-black text-white">--:--</span>
                    </div>
                    <div class="flex justify-between items-center bg-blue-800/50 p-3 rounded-lg border-l-4 border-orange-500">
                        <span id="label-minha_semaine" class="text-orange-400 font-black">Minha / Arvit</span>
                        <span id="sheet-minha_semaine" class="text-4xl font-black text-white">--:--</span>
                    </div>
                </div>
            </div>

            <div class="bg-blue-900/40 border border-gold/30 rounded-xl overflow-hidden shadow-2xl">
                <div class="bg-gold text-blue-900 text-center font-black py-2 text-sm uppercase" data-i18n="title_shabbat">Chabbat</div>
                <div class="p-2 space-y-2">
                    <div class="flex justify-between items-center border-b border-white/5 px-2">
                        <span id="label-minha_vendredi" class="text-blue-300 font-bold text-sm">Minha Vendredi</span>
                        <span id="sheet-minha_vendredi" class="text-xl font-bold">--:--</span>
                    </div>
                    <div class="flex justify-between items-center border-b border-white/5 px-2">
                        <span id="label-chaharit_shabbat" class="text-white font-bold text-sm">Chaharit (2 offices)</span>
                        <span id="sheet-chaharit_shabbat" class="text-xl font-bold">--:--</span>
                    </div>
                    <div class="bg-white/5 rounded p-2 grid grid-cols-2 gap-2 text-xs italic text-blue-100">
                        <div class="flex justify-between"><span>Shiour DAN</span><span id="sheet-shiour_dan">--:--</span></div>
                        <div class="flex justify-between"><span>Rav Saadia</span><span id="sheet-shiour_saadia">--:--</span></div>
                        <div class="flex justify-between"><span>Rav Haviv</span><span id="sheet-shiour_haviv">--:--</span></div>
                        <div class="flex justify-between"><span>Guémara</span><span id="sheet-shiour_guemara">--:--</span></div>
                    </div>
                    <div class="flex justify-between items-center px-2">
                        <span id="label-minha_shabbat" class="text-orange-400 font-bold">Minha Chabbat</span>
                        <span id="sheet-minha_shabbat" class="text-xl font-bold">--:--</span>
                    </div>
                    <div class="bg-blue-600 p-3 rounded-lg flex justify-between items-center">
                        <span id="label-arvit_motsach" class="text-white font-black uppercase" data-i18n="motsach">Arvit Motzaé</span>
                        <span id="sheet-arvit_motsach" class="text-3xl font-black text-white">--:--</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 text-center bg-gold/10 border border-gold/30 p-2 rounded-full">
            <span class="text-gold font-bold italic tracking-widest text-sm">
                 ✦ <span id="auto-liturgie">Mashiv HaRouah VeMorid HaGueshem</span> ✦
            </span>
        </div>
    </div>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9yq5Z2NPxlAp9hmI1hZdnfpGme_8SQXj6QcyyagTIaNb5JX1RX8FHhBFuqhrroCH154U1_bEMUX9t/pub?gid=0&single=true&output=csv";

        const i18n = {
            fr: { title_week: "Semaine", title_shabbat: "Chabbat", parasha_label: "Paracha", candles_label: "Bougies", havdala_label: "Havdala" },
            he: { title_week: "יום חול", title_shabbat: "שבת קודש", parasha_label: "פרשת השבוע", candles_label: "הדלקת נרות", havdala_label: "צאת שבת" },
            en: { title_week: "Weekdays", title_shabbat: "Shabbat", parasha_label: "Parasha", candles_label: "Candles", havdala_label: "Havdala" }
        };

        function setLanguage(lang) {
            localStorage.setItem('selectedLang', lang);
            document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = i18n[lang][el.getAttribute('data-i18n')]; });
            const mainGrid = document.getElementById('main-grid');
            if(lang === 'he') { mainGrid.classList.add('content-rtl'); } else { mainGrid.classList.remove('content-rtl'); }
        }

        async function loadZmanim() {
            try {
                const res = await fetch('https://www.hebcal.com/shabbat?cfg=json&city=IL-Jerusalem&lg=s');
                const data = await res.json();
                const parashaItem = data.items.find(i => i.category === "parashat");
                if(parashaItem) document.getElementById('auto-paracha').textContent = parashaItem.title;
                const candlesItem = data.items.find(i => i.category === "candles");
                if(candlesItem) document.getElementById('auto-candles').textContent = new Date(candlesItem.date).toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
                const havdalaItem = data.items.find(i => i.category === "havdala");
                if(havdalaItem) document.getElementById('auto-havdala').textContent = new Date(havdalaItem.date).toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
            } catch(e) { console.error("Zmanim error"); }
        }

        async function loadSheet() {
            try {
                const response = await fetch(SHEET_URL + "&cb=" + Date.now());
                const csvText = await response.text();
                const lines = csvText.split(/\r?\n/);
                lines.forEach((line, index) => {
                    if (index === 0) return;
                    const parts = line.split(/[,;]/);
                    if (parts.length >= 3) {
                        let key = parts[0].replace(/["']/g, "").trim().toLowerCase();
                        let intitule = parts[1].replace(/["']/g, "").trim();
                        let value = parts[2].replace(/["']/g, "").trim();

                        const labelEl = document.getElementById(`label-${key}`);
                        if (labelEl && intitule !== "") labelEl.textContent = intitule;

                        const valueEl = document.getElementById(`sheet-${key}`);
                        if (valueEl && value !== "") valueEl.textContent = value;
                    }
                });
            } catch (e) { console.error("Sheet error"); }
        }

        setLanguage(localStorage.getItem('selectedLang') || 'fr');
        loadZmanim();
        loadSheet();
        setInterval(loadSheet, 30000);
    </script>
</body>
</html>
