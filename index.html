<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ohavei Tsion - Jérusalem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap');
        body { font-family: 'Assistant', sans-serif; background-color: #f0f4f8; }
        .fixed-layout { direction: ltr !important; }
        .content-rtl { direction: rtl; }
        .content-ltr { direction: ltr; }
        td.label-cell { padding-left: 1rem; padding-right: 1rem; }
        /* Style inspiré des écrans de la synagogue */
        .zman-card { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); border: 1px solid #fbbf24; }
    </style>
</head>
<body class="text-slate-900 pb-10">

    <header class="bg-white border-b-2 border-blue-900 shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 max-w-5xl flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img src="https://ohavei-tsion.org/wp-content/uploads/2019/04/cropped-ohavei-logo-1.png" alt="Logo" class="h-10 w-auto">
                <h1 class="text-xl font-bold text-blue-900 hidden sm:block">Ohavei Tsion</h1>
            </div>
            <div class="flex gap-2 fixed-layout">
                <button onclick="setLanguage('fr')" class="px-3 py-1 text-sm border border-slate-300 rounded font-bold hover:bg-blue-900 hover:text-white transition">FR</button>
                <button onclick="setLanguage('he')" class="px-3 py-1 text-sm border border-slate-300 rounded font-bold hover:bg-blue-900 hover:text-white transition">עב</button>
                <button onclick="setLanguage('en')" class="px-3 py-1 text-sm border border-slate-300 rounded font-bold hover:bg-blue-900 hover:text-white transition">EN</button>
            </div>
        </div>
    </header>

    <main class="container mx-auto mt-6 px-4 max-w-5xl">
        
        <div class="zman-card text-white p-4 rounded-xl shadow-lg mb-6 flex flex-wrap justify-around items-center text-center gap-4 border-b-4 border-yellow-500">
            <div>
                <p class="text-xs uppercase opacity-80" data-i18n="parasha_label">Paracha</p>
                <p id="auto-paracha" class="text-lg font-bold">--</p>
            </div>
            <div class="h-10 w-px bg-white/20 hidden md:block"></div>
            <div>
                <p class="text-xs uppercase opacity-80" data-i18n="candles_label">Bougies</p>
                <p id="auto-candles" class="text-lg font-bold">--:--</p>
            </div>
            <div class="h-10 w-px bg-white/20 hidden md:block"></div>
            <div>
                <p class="text-xs uppercase opacity-80" data-i18n="havdala_label">Havdala</p>
                <p id="auto-havdala" class="text-lg font-bold">--:--</p>
            </div>
            <div class="h-10 w-px bg-white/20 hidden md:block"></div>
            <div class="bg-white/10 px-4 py-1 rounded-full border border-white/30">
                <p id="auto-liturgie" class="text-sm font-bold italic">Mashiv HaRouah</p>
            </div>
        </div>

        <div id="annonce-container" class="mb-8 bg-white border-l-4 border-blue-900 p-6 rounded-xl shadow-md hidden">
            <h3 id="sheet-annonce_titre" class="text-xl font-bold text-blue-900 mb-1"></h3>
            <p id="sheet-annonce_texte" class="text-lg text-slate-700"></p>
        </div>

        <div id="main-grid" class="grid md:grid-cols-2 gap-8">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-slate-800 p-3 text-white text-center font-bold uppercase tracking-wider text-sm">
                    <span data-i18n="title_week">Semaine</span>
                </div>
                <table class="w-full border-collapse">
                    <tr class="border-b">
                        <td id="label-chaharit_semaine" class="p-4 font-semibold text-slate-500 label-cell">Chaharit</td>
                        <td id="sheet-chaharit_semaine" class="p-4 text-right font-bold text-xl text-blue-900">--:--</td>
                    </tr>
                    <tr class="bg-orange-50/30">
                        <td id="label-minha_semaine" class="p-4 font-bold text-orange-800 label-cell">Minha / Arvit</td>
                        <td id="sheet-minha_semaine" class="p-4 text-right font-black text-2xl text-orange-600">--:--</td>
                    </tr>
                </table>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-blue-900 p-3 text-white text-center font-bold uppercase tracking-wider text-sm">
                    <span data-i18n="title_shabbat">Chabbat</span>
                </div>
                <table class="w-full border-collapse">
                    <tr class="border-b bg-blue-50/50">
                        <td id="label-minha_vendredi" class="p-3 font-bold text-blue-900 label-cell">Minha Vendredi</td>
                        <td id="sheet-minha_vendredi" class="p-3 text-right font-bold text-blue-900">--:--</td>
                    </tr>
                    <tr class="border-b">
                        <td id="label-chaharit_shabbat" class="p-3 font-semibold label-cell">Chaharit</td>
                        <td id="sheet-chaharit_shabbat" class="p-3 text-right font-bold">--:--</td>
                    </tr>
                    <tr class="border-b text-slate-500 italic text-sm">
                        <td id="label-shiour_dan" class="p-3 label-cell">Shiour de DAN</td>
                        <td id="sheet-shiour_dan" class="p-3 text-right font-bold">--:--</td>
                    </tr>
                    <tr class="border-b text-slate-500 italic text-sm">
                        <td id="label-shiour_saadia" class="p-3 label-cell">Rav Saadia</td>
                        <td id="sheet-shiour_saadia" class="p-3 text-right font-bold">--:--</td>
                    </tr>
                    <tr class="border-b">
                        <td id="label-minha_shabbat" class="p-3 font-bold text-orange-600 label-cell">Minha Chabbat</td>
                        <td id="sheet-minha_shabbat" class="p-3 text-right font-bold text-orange-600">--:--</td>
                    </tr>
                    <tr class="bg-blue-900 text-white">
                        <td id="label-arvit_motsach" class="p-4 font-bold label-cell">Arvit Motzaé</td>
                        <td id="sheet-arvit_motsach" class="p-4 text-right font-black text-2xl">--:--</td>
                    </tr>
                </table>
            </div>
        </div>
    </main>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9yq5Z2NPxlAp9hmI1hZdnfpGme_8SQXj6QcyyagTIaNb5JX1RX8FHhBFuqhrroCH154U1_bEMUX9t/pub?gid=0&single=true&output=csv";

        const i18n = {
            fr: { title_week: "Semaine", title_shabbat: "Chabbat", parasha_label: "Paracha", candles_label: "Bougies", havdala_label: "Havdala" },
            he: { title_week: "יום חול", title_shabbat: "שבת קודش", parasha_label: "פרשת השבוע", candles_label: "הדלקת נרות", havdala_label: "צאת שבת" },
            en: { title_week: "Weekdays", title_shabbat: "Shabbat", parasha_label: "Parasha", candles_label: "Candles", havdala_label: "Havdala" }
        };

        function setLanguage(lang) {
            localStorage.setItem('selectedLang', lang);
            document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = i18n[lang][el.getAttribute('data-i18n')]; });
            const mainGrid = document.getElementById('main-grid');
            const isHe = lang === 'he';
            if(isHe) { mainGrid.classList.add('content-rtl'); } else { mainGrid.classList.remove('content-rtl'); }
            
            document.querySelectorAll('td').forEach(td => {
                if (td.id && td.id.startsWith('sheet') || td.innerText.includes(':')) { 
                    td.style.textAlign = isHe ? 'left' : 'right';
                } else { 
                    td.style.textAlign = isHe ? 'right' : 'left';
                }
            });
        }

        async function loadZmanim() {
            try {
                const res = await fetch('https://www.hebcal.com/shabbat?cfg=json&city=IL-Jerusalem&lg=s');
                const data = await res.json();
                
                // Paracha
                const parashaItem = data.items.find(i => i.category === "parashat");
                document.getElementById('auto-paracha').textContent = parashaItem ? parashaItem.title : "";

                // Bougies
                const candlesItem = data.items.find(i => i.category === "candles");
                if(candlesItem) document.getElementById('auto-candles').textContent = new Date(candlesItem.date).toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});

                // Havdala
                const havdalaItem = data.items.find(i => i.category === "havdala");
                if(havdalaItem) document.getElementById('auto-havdala').textContent = new Date(havdalaItem.date).toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});

                // Liturgie (Saison)
                const month = new Date().getMonth() + 1; 
                document.getElementById('auto-liturgie').textContent = (month >= 11 || month <= 3) ? "Morid HaGueshem" : "Morid HaTal";

            } catch(e) { console.error("Zmanim error"); }
        }

        async function loadSheet() {
            try {
                const response = await fetch(SHEET_URL + "&cb=" + Date.now());
                const csvText = await response.text();
                const lines = csvText.split(/\r?\n/);
                lines.forEach((line, index) => {
                    if (index === 0) return;
                    const parts = line.split(/[,;]/);
                    if (parts.length >= 3) {
                        let key = parts[0].replace(/["']/g, "").trim().toLowerCase();
                        let intitule = parts[1].replace(/["']/g, "").trim();
                        let value = parts[2].replace(/["']/g, "").trim();

                        const labelEl = document.getElementById(`label-${key}`);
                        if (labelEl && intitule !== "") labelEl.textContent = intitule;

                        const valueEl = document.getElementById(`sheet-${key}`);
                        if (valueEl && value !== "") valueEl.textContent = value;

                        if (key === 'annonce_titre') document.getElementById('sheet-annonce_titre').textContent = value;
                        if (key === 'annonce_texte') {
                            document.getElementById('sheet-annonce_texte').textContent = value;
                            if (value.trim() !== "") document.getElementById('annonce-container').classList.remove('hidden');
                            else document.getElementById('annonce-container').classList.add('hidden');
                        }
                    }
                });
            } catch (e) { console.error("Sheet error"); }
        }

        setLanguage(localStorage.getItem('selectedLang') || 'fr');
        loadZmanim();
        loadSheet();
        setInterval(loadSheet, 30000);
    </script>
</body>
</html>
