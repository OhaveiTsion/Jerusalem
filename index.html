<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ohavei Tsion - Jérusalem</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700;800&display=swap');
        
        :root {
            --bg-deep-blue: #0f34a1;
            --gold-border: #f1c40f;
            --card-blue: rgba(255, 255, 255, 0.08);
        }

        body { 
            font-family: 'Assistant', sans-serif; 
            background-color: var(--bg-deep-blue);
            color: white;
            padding: 15px;
        }

        .main-container {
            border: 3px solid var(--gold-border);
            border-radius: 25px;
            min-height: calc(100vh - 30px);
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .zman-box {
            background: white;
            border-radius: 15px;
            color: #0f34a1;
            padding: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .section-card {
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 20px;
            background: var(--card-blue);
            margin-bottom: 20px;
        }

        .highlight-row {
            background: #2563eb;
            border-radius: 12px;
            border-left: 4px solid #f97316;
            padding: 12px;
        }

        .liturgie-pill {
            border: 1px solid white;
            border-radius: 50px;
            padding: 10px 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .fixed-layout { direction: ltr !important; }
        .content-rtl { direction: rtl; }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="flex justify-between items-start mb-6">
            <div class="flex flex-col gap-2">
                <img src="https://ohavei-tsion.org/wp-content/uploads/2019/04/cropped-ohavei-logo-1.png" alt="Logo" class="h-12 w-auto rounded bg-white/10 p-1">
                <div class="flex gap-1 fixed-layout">
                    <button onclick="setLanguage('fr')" class="text-[10px] border border-white/30 px-2 py-0.5 rounded">FR</button>
                    <button onclick="setLanguage('he')" class="text-[10px] border border-white/30 px-2 py-0.5 rounded">עב</button>
                    <button onclick="setLanguage('en')" class="text-[10px] border border-white/30 px-2 py-0.5 rounded">EN</button>
                </div>
            </div>
            <div class="text-right">
                <h1 class="text-2xl font-black italic tracking-tighter">OHAVEI<br>TSION</h1>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-3 mb-8">
            <div class="zman-box">
                <p class="text-[10px] font-bold uppercase text-slate-400" data-i18n="parasha_label">Paracha</p>
                <p id="auto-paracha" class="text-sm font-black leading-tight">--</p>
            </div>
            <div class="zman-box">
                <p class="text-[10px] font-bold uppercase text-slate-400" data-i18n="candles_label">Bougies</p>
                <p id="auto-candles" class="text-2xl font-black text-red-600">--:--</p>
            </div>
            <div class="zman-box">
                <p class="text-[10px] font-bold uppercase text-slate-400" data-i18n="havdala_label">Havdala</p>
                <p id="auto-havdala" class="text-2xl font-black">--:--</p>
            </div>
        </div>

        <div class="section-card">
            <h2 class="text-center text-[10px] font-bold tracking-widest opacity-50 mb-4 uppercase" data-i18n="title_week">Semaine</h2>
            <div class="space-y-4">
                <div class="flex justify-between items-center px-2">
                    <span id="label-chaharit_semaine" class="font-bold text-sm">SHAHARIT</span>
                    <span id="sheet-chaharit_semaine" class="text-3xl font-bold">07:00</span>
                </div>
                <div class="highlight-row flex justify-between items-center">
                    <span id="label-minha_semaine" class="font-bold text-orange-300">Minha suivi d'Arvit</span>
                    <span id="sheet-minha_semaine" class="text-3xl font-bold text-white">17:05</span>
                </div>
            </div>
        </div>

        <div class="section-card">
            <h2 class="text-center text-[10px] font-bold tracking-widest opacity-50 mb-4 uppercase" data-i18n="title_shabbat">Chabbat</h2>
            <div class="space-y-3 px-2">
                <div class="flex justify-between items-center opacity-70">
                    <span id="label-minha_vendredi" class="text-sm">Minha Vendredi Soir</span>
                    <span id="sheet-minha_vendredi" class="text-lg font-bold">17:15</span>
                </div>
                <div class="flex justify-between items-center border-t border-white/10 pt-2">
                    <span id="label-chaharit_shabbat" class="font-bold text-sm">Shaharit (2 Offices)</span>
                    <span id="sheet-chaharit_shabbat" class="text-lg font-bold">08:15 / 08:45</span>
                </div>
                
                <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-[11px] italic opacity-60">
                    <div class="flex justify-between"><span>Shiour DAN</span><span id="sheet-shiour_dan">11:15</span></div>
                    <div class="flex justify-between"><span>Rav Saadia</span><span id="sheet-shiour_saadia">14:25</span></div>
                    <div class="flex justify-between"><span>Rav Haviv</span><span id="sheet-shiour_haviv">15:30</span></div>
                    <div class="flex justify-between"><span>Guémara</span><span id="sheet-shiour_guemara">15:30</span></div>
                </div>

                <div class="flex justify-between items-center text-orange-400 font-bold border-t border-white/10 pt-2">
                    <span id="label-minha_shabbat" class="text-sm leading-tight">Minha suivi de Seouda Shlishit</span>
                    <span id="sheet-minha_shabbat" class="text-xl">16:30</span>
                </div>

                <div class="bg-blue-600 rounded-xl p-3 flex justify-between items-center">
                    <span class="font-bold text-sm uppercase">Arvit Motsae Shabbat</span>
                    <span id="sheet-arvit_motsach" class="text-2xl font-black">18:02</span>
                </div>
            </div>
        </div>

        <div class="text-center">
            <div class="liturgie-pill text-[11px] font-bold italic">
                ✦ <span id="auto-liturgie">Mashiv HaRouah VeMorid HaGueshem</span> ✦
            </div>
        </div>
    </div>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9yq5Z2NPxlAp9hmI1hZdnfpGme_8SQXj6QcyyagTIaNb5JX1RX8FHhBFuqhrroCH154U1_bEMUX9t/pub?gid=0&single=true&output=csv";

        const i18n = {
            fr: { title_week: "Semaine", title_shabbat: "Chabbat", parasha_label: "Paracha", candles_label: "Bougies", havdala_label: "Havdala" },
            he: { title_week: "יום חול", title_shabbat: "שבת קודש", parasha_label: "פרשת", candles_label: "הדלקת נרות", havdala_label: "צאת שבת" },
            en: { title_week: "Weekdays", title_shabbat: "Shabbat", parasha_label: "Parasha", candles_label: "Candles", havdala_label: "Havdala" }
        };

        function setLanguage(lang) {
            localStorage.setItem('selectedLang', lang);
            document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = i18n[lang][el.getAttribute('data-i18n')]; });
            const container = document.querySelector('.main-container');
            if(lang === 'he') container.classList.add('content-rtl'); else container.classList.remove('content-rtl');
        }

        async function loadZmanim() {
            try {
                const res = await fetch('https://www.hebcal.com/shabbat?cfg=json&city=IL-Jerusalem&lg=s');
                const data = await res.json();
                const parashaItem = data.items.find(i => i.category === "parashat");
                if(parashaItem) document.getElementById('auto-paracha').textContent = parashaItem.title;
                const candlesItem = data.items.find(i => i.category === "candles");
                if(candlesItem) document.getElementById('auto-candles').textContent = new Date(candlesItem.date).toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
                const havdalaItem = data.items.find(i => i.category === "havdala");
                if(havdalaItem) document.getElementById('auto-havdala').textContent = new Date(havdalaItem.date).toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
            } catch(e) { console.error("Zmanim error"); }
        }

        async function loadSheet() {
            try {
                const response = await fetch(SHEET_URL + "&cb=" + Date.now());
                const csvText = await response.text();
                const lines = csvText.split(/\r?\n/);
                lines.forEach((line, index) => {
                    if (index === 0) return;
                    const parts = line.split(/[,;]/);
                    if (parts.length >= 3) {
                        let key = parts[0].replace(/["']/g, "").trim().toLowerCase();
                        let intitule = parts[1].replace(/["']/g, "").trim();
                        let value = parts[2].replace(/["']/g, "").trim();
                        const labelEl = document.getElementById(`label-${key}`);
                        if (labelEl && intitule !== "") labelEl.textContent = intitule;
                        const valueEl = document.getElementById(`sheet-${key}`);
                        if (valueEl && value !== "") valueEl.textContent = value;
                    }
                });
            } catch (e) { console.error("Sheet error"); }
        }

        setLanguage(localStorage.getItem('selectedLang') || 'fr');
        loadZmanim();
        loadSheet();
        setInterval(loadSheet, 30000);
    </script>
</body>
</html>
